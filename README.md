<p align="center">
  <a href="https://librechat.ai">
    <img src="client/public/assets/logo.svg" height="256">
  </a>
  <h1 align="center">
    <a href="https://librechat.ai">LibreChat</a>
  </h1>
</p>

<p align="center">
  <a href="https://discord.librechat.ai"> 
    <img
      src="https://img.shields.io/discord/1086345563026489514?label=&logo=discord&style=for-the-badge&logoWidth=20&logoColor=white&labelColor=000000&color=blueviolet">
  </a>
  <a href="https://www.youtube.com/@LibreChat"> 
    <img
      src="https://img.shields.io/badge/YOUTUBE-red.svg?style=for-the-badge&logo=youtube&logoColor=white&labelColor=000000&logoWidth=20">
  </a>
  <a href="https://docs.librechat.ai"> 
    <img
      src="https://img.shields.io/badge/DOCS-blue.svg?style=for-the-badge&logo=read-the-docs&logoColor=white&labelColor=000000&logoWidth=20">
  </a>
  <a aria-label="Sponsors" href="https://github.com/sponsors/danny-avila">
    <img
      src="https://img.shields.io/badge/SPONSORS-brightgreen.svg?style=for-the-badge&logo=github-sponsors&logoColor=white&labelColor=000000&logoWidth=20">
  </a>
</p>

<p align="center">
<a href="https://railway.app/template/b5k2mn?referralCode=HI9hWz">
  <img src="https://railway.app/button.svg" alt="Deploy on Railway" height="30">
</a>
<a href="https://zeabur.com/templates/0X2ZY8">
  <img src="https://zeabur.com/button.svg" alt="Deploy on Zeabur" height="30"/>
</a>
<a href="https://template.cloud.sealos.io/deploy?templateName=librechat">
  <img src="https://raw.githubusercontent.com/labring-actions/templates/main/Deploy-on-Sealos.svg" alt="Deploy on Sealos" height="30">
</a>
</p>

<p align="center">
  <a href="https://www.librechat.ai/docs/translation">
    <img 
      src="https://img.shields.io/badge/dynamic/json.svg?style=for-the-badge&color=2096F3&label=locize&query=%24.translatedPercentage&url=https://api.locize.app/badgedata/4cb2598b-ed4d-469c-9b04-2ed531a8cb45&suffix=%+translated" 
      alt="Translation Progress">
  </a>
</p>


# ✨ Features

- 🖥️ **UI & Experience** inspired by ChatGPT with enhanced design and features

- 🤖 **AI Model Selection**:  
  - Anthropic (Claude), AWS Bedrock, OpenAI, Azure OpenAI, Google, Vertex AI, OpenAI Assistants API (incl. Azure)
  - [Custom Endpoints](https://www.librechat.ai/docs/quick_start/custom_endpoints): Use any OpenAI-compatible API with LibreChat, no proxy required
  - Compatible with [Local & Remote AI Providers](https://www.librechat.ai/docs/configuration/librechat_yaml/ai_endpoints):
    - Ollama, groq, Cohere, Mistral AI, Apple MLX, koboldcpp, together.ai,
    - OpenRouter, Perplexity, ShuttleAI, Deepseek, Qwen, and more

- 🔧 **[Code Interpreter API](https://www.librechat.ai/docs/features/code_interpreter)**: 
  - Secure, Sandboxed Execution in Python, Node.js (JS/TS), Go, C/C++, Java, PHP, Rust, and Fortran
  - Seamless File Handling: Upload, process, and download files directly
  - No Privacy Concerns: Fully isolated and secure execution

- 🔦 **Agents & Tools Integration**:  
  - **[LibreChat Agents](https://www.librechat.ai/docs/features/agents)**:
    - No-Code Custom Assistants: Build specialized, AI-driven helpers without coding  
    - Flexible & Extensible: Attach tools like DALL-E-3, file search, code execution, and more  
    - Compatible with Custom Endpoints, OpenAI, Azure, Anthropic, AWS Bedrock, and more
    - [Model Context Protocol (MCP) Support](https://modelcontextprotocol.io/clients#librechat) for Tools
  - Use LibreChat Agents and OpenAI Assistants with Files, Code Interpreter, Tools, and API Actions

- 🪄 **Generative UI with Code Artifacts**:  
  - [Code Artifacts](https://youtu.be/GfTj7O4gmd0?si=WJbdnemZpJzBrJo3) allow creation of React, HTML, and Mermaid diagrams directly in chat

- 💾 **Presets & Context Management**:  
  - Create, Save, & Share Custom Presets  
  - Switch between AI Endpoints and Presets mid-chat
  - Edit, Resubmit, and Continue Messages with Conversation branching  
  - [Fork Messages & Conversations](https://www.librechat.ai/docs/features/fork) for Advanced Context control

- 💬 **Multimodal & File Interactions**:  
  - Upload and analyze images with Claude 3, GPT-4.5, GPT-4o, o1, Llama-Vision, and Gemini 📸  
  - Chat with Files using Custom Endpoints, OpenAI, Azure, Anthropic, AWS Bedrock, & Google 🗃️

- 🌎 **Multilingual UI**:  
  - English, 中文, Deutsch, Español, Français, Italiano, Polski, Português Brasileiro
  - Русский, 日本語, Svenska, 한국어, Tiếng Việt, 繁體中文, العربية, Türkçe, Nederlands, עברית

- 🧠 **Reasoning UI**:  
  - Dynamic Reasoning UI for Chain-of-Thought/Reasoning AI models like DeepSeek-R1

- 🎨 **Customizable Interface**:  
  - Customizable Dropdown & Interface that adapts to both power users and newcomers

- 🗣️ **Speech & Audio**:  
  - Chat hands-free with Speech-to-Text and Text-to-Speech  
  - Automatically send and play Audio  
  - Supports OpenAI, Azure OpenAI, and Elevenlabs

- 📥 **Import & Export Conversations**:  
  - Import Conversations from LibreChat, ChatGPT, Chatbot UI  
  - Export conversations as screenshots, markdown, text, json

- 🔍 **Search & Discovery**:  
  - Search all messages/conversations

- 👥 **Multi-User & Secure Access**:
  - Multi-User, Secure Authentication with OAuth2, LDAP, & Email Login Support
  - Built-in Moderation, and Token spend tools

- ⚙️ **Configuration & Deployment**:  
  - Configure Proxy, Reverse Proxy, Docker, & many Deployment options  
  - Use completely local or deploy on the cloud

- 📖 **Open-Source & Community**:  
  - Completely Open-Source & Built in Public  
  - Community-driven development, support, and feedback

[For a thorough review of our features, see our docs here](https://docs.librechat.ai/) 📚

## 🪶 All-In-One AI Conversations with LibreChat

LibreChat brings together the future of assistant AIs with the revolutionary technology of OpenAI's ChatGPT. Celebrating the original styling, LibreChat gives you the ability to integrate multiple AI models. It also integrates and enhances original client features such as conversation and message search, prompt templates and plugins.

With LibreChat, you no longer need to opt for ChatGPT Plus and can instead use free or pay-per-call APIs. We welcome contributions, cloning, and forking to enhance the capabilities of this advanced chatbot platform.

[![Watch the video](https://raw.githubusercontent.com/LibreChat-AI/librechat.ai/main/public/images/changelog/v0.7.6.gif)](https://www.youtube.com/watch?v=ilfwGQtJNlI)

Click on the thumbnail to open the video☝️

---

## 🌐 Resources

**GitHub Repo:**
  - **RAG API:** [github.com/danny-avila/rag_api](https://github.com/danny-avila/rag_api)
  - **Website:** [github.com/LibreChat-AI/librechat.ai](https://github.com/LibreChat-AI/librechat.ai)

**Other:**
  - **Website:** [librechat.ai](https://librechat.ai)
  - **Documentation:** [docs.librechat.ai](https://docs.librechat.ai)
  - **Blog:** [blog.librechat.ai](https://blog.librechat.ai)

---

## 📝 Changelog

Keep up with the latest updates by visiting the releases page and notes:
- [Releases](https://github.com/danny-avila/LibreChat/releases)
- [Changelog](https://www.librechat.ai/changelog) 

**⚠️ Please consult the [changelog](https://www.librechat.ai/changelog) for breaking changes before updating.**

---

## ⭐ Star History

<p align="center">
  <a href="https://star-history.com/#danny-avila/LibreChat&Date">
    <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=danny-avila/LibreChat&type=Date&theme=dark" onerror="this.src='https://api.star-history.com/svg?repos=danny-avila/LibreChat&type=Date'" />
  </a>
</p>
<p align="center">
  <a href="https://trendshift.io/repositories/4685" target="_blank" style="padding: 10px;">
    <img src="https://trendshift.io/api/badge/repositories/4685" alt="danny-avila%2FLibreChat | Trendshift" style="width: 250px; height: 55px;" width="250" height="55"/>
  </a>
  <a href="https://runacap.com/ross-index/q1-24/" target="_blank" rel="noopener" style="margin-left: 20px;">
    <img style="width: 260px; height: 56px" src="https://runacap.com/wp-content/uploads/2024/04/ROSS_badge_white_Q1_2024.svg" alt="ROSS Index - Fastest Growing Open-Source Startups in Q1 2024 | Runa Capital" width="260" height="56"/>
  </a>
</p>

---

## ✨ Contributions

Contributions, suggestions, bug reports and fixes are welcome!

For new features, components, or extensions, please open an issue and discuss before sending a PR.

If you'd like to help translate LibreChat into your language, we'd love your contribution! Improving our translations not only makes LibreChat more accessible to users around the world but also enhances the overall user experience. Please check out our [Translation Guide](https://www.librechat.ai/docs/translation).

---

## 💖 This project exists in its current state thanks to all the people who contribute

<a href="https://github.com/danny-avila/LibreChat/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=danny-avila/LibreChat" />
</a>

---

## 🎉 Special Thanks

We thank [Locize](https://locize.com) for their translation management tools that support multiple languages in LibreChat.

<p align="center">
  <a href="https://locize.com" target="_blank" rel="noopener noreferrer">
    <img src="https://github.com/user-attachments/assets/d6b70894-6064-475e-bb65-92a9e23e0077" alt="Locize Logo" height="50">
  </a>
</p>


<a href="https://gpt.we-build-ai.de">
<img src="client/public/assets/logo.svg" height="64">
</a>
</br>
<h3>
Deploying <a href="https://gpt.we-build-ai.de">LibreChat</a> on Azure (Virtual Machine)
</h3>

The following instructions are primarily derived from the [LibreChat Documentation](https://www.librechat.ai/docs/). If you encounter any issues, you will likely find a solution in the documentation.

---

</br>

## 0. Setup for local usage

### a. Install Docker

```bash
brew install docker
```

### b. Install Git
```bash
brew install git
```

### c. Clone the Librechat repository

```bash
git clone https://github.com/we-build-ai-consulting/LibreChat.git

cd LibreChat/ 
```

### d. Copy the .env.example file to .env

```bash
cp .env.example .env
```

### e. Update the .env file

```bash
nano .env
```

Replace the following values in your `.env` file to ensure they differ from the default values. Refer to the LibreChat documentation for guidance [here](https://www.librechat.ai/docs/remote/docker_linux#:~:text=However%2C%20it%E2%80%99s%20highly%20recommended%20you%20adjust%20the%20%E2%80%9Csecret%E2%80%9D%20values).

#### Required Variables
- **CREDS_IV**: Must be a 16-byte IV (32 characters in hex)
```bash
CREDS_IV=e2341419ec3dd3d19b13a1a87fafcbfb
```

- **CREDS_KEY**: Must be 32-byte keys (64 characters in hex)
```bash
CREDS_KEY=f34be427ebb29de8d88c107a71546019685ed8b241d8f2ed00c3df97ad2566f0
```

- **JWT_SECRET**: 
```bash
JWT_SECRET=16f8c0ef4a5d391b26034086c628469d3f9f497f08163ab9b40137092f2909ef
```

- **JWT_REFRESH_SECRET**: 
```bash
JWT_REFRESH_SECRET=eaa5191f2914e30b9387fd84e254e4ba6fc51b4654968a9b0803b456a54b8418
```

### f. Insert Azure OpenAI Resource Details
Insert the API key from your Azure OpenAI Resource into the `.env` file and replace the resource name with yours:
```bash
# GPT Configuration
AZURE_OAI_RG=YOUR AZURE OPENAI RESOURCE GROUP
AZURE_OAI_API_KEY=YOUR AZURE OPENAI KEY
AZURE_OAI_RESOURCE=YOUR AZURE OPENAI RESOURCE NAME (the resource name, not the resource url)
AZURE_OAI_API_VERSION=YOUR AZURE OPENAI API VERSION (e.g. 2024-06-01)
```

### g. Change the librechat.example.yaml to librechat.yaml and update the librechat.yaml file
```yaml
endpoints:
  azureOpenAI:
      titleModel: "gpt-4o-mini"
      titleConvo: true
      titleMethod: "completion"
      plugins: true
      assistans: false
      summarize: false
      groups:
        - group: "${AZURE_OAI_RG}"
          apiKey: "${AZURE_OAI_API_KEY}"
          instanceName: "${AZURE_OAI_RESOURCE}"
          version: "${AZURE_OAI_API_VERSION}"
          models:
            gpt-4o:
              deploymentName: "gpt-4o"
            gpt-4o-mini:
              deploymentName: "gpt-4o-mini"
```
Under models, you can add more models if you want to. Important: only add models that are available in your Azure OpenAI Resource.

### h. Add the librechat.yaml to the docker-compose.yml file to the mount volume
```bash
services:
  api:
    container_name: LibreChat
    ports:
      - "${PORT}:${PORT}"
        ...
    environment:
        ...
    volumes:
        ...
      - ./librechat.yaml:/app/librechat.yaml
```

### i. Start docker compose
```bash
docker compose up -d
```
#### If you have changes and want to restart the app, you can use the following command:
```bash
docker compose down
docker compose up -d
```


### i. Open the app in your browser
```bash
http://localhost:3080
```


## 1. Create a Virtual Machine

### Recommended Setup:
```
    VM Size:    B2s
    Type:       General purpose
    vCPUs:      2
    RAM (GiB):  4
    
    Estimated Cost:  $35.04 / Month

    Operating System: Linux (Ubuntu 24.04)
```
</br>

## 2. Set Up the Virtual Machine - Installing Docker and Other Dependencies

Log into your virtual machine and follow the steps below to set up the environment.

### Step 1: Update Package List and Install Required Docker Dependencies
```bash
sudo apt update
sudo apt install apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release
```

### Step 2: Add Docker Repository to APT Sources
```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt update
```

### Step 3: Install Docker
```bash
sudo apt install docker-ce

sudo usermod -aG docker $USER
```

### Step 4: Reboot the System
```bash
sudo reboot
```

### Step 5: Install the Latest Version of Docker Compose
```bash
sudo curl -L https://github.com/docker/compose/releases/download/v2.26.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-composecd 
```

### Step 6: Install Git and npm
```bash
sudo apt install git nodejs npm
```

---

## 3. Setup LibreChat

### Step 1: Clone the Repository
Clone this repository to your workspace:
```bash
git clone https://github.com/we-build-ai-consulting/LibreChat.git

cd LibreChat/
```

You might need to switch the branch to `we-build-ai`
```bash
git checkout we-build-ai
```

### Step 2: Copy the Environment File
Copy the `.example.env` file to `.env`:
```bash
cp .env.example .env
```

### Step 3: Update Environment Variables
Open the `.env` file for editing:
```bash
nano .env
```

Replace the following values in your `.env` file to ensure they differ from the default values. Refer to the LibreChat documentation for guidance [here](https://www.librechat.ai/docs/remote/docker_linux#:~:text=However%2C%20it%E2%80%99s%20highly%20recommended%20you%20adjust%20the%20%E2%80%9Csecret%E2%80%9D%20values).

#### Required Variables
- **CREDS_IV**: Must be a 16-byte IV (32 characters in hex)
```bash
CREDS_IV=e2341419ec3dd3d19b13a1a87fafcbfb
```

- **CREDS_KEY**: Must be 32-byte keys (64 characters in hex)
```bash
CREDS_KEY=f34be427ebb29de8d88c107a71546019685ed8b241d8f2ed00c3df97ad2566f0
```

- **JWT_SECRET**: 
```bash
JWT_SECRET=16f8c0ef4a5d391b26034086c628469d3f9f497f08163ab9b40137092f2909ef
```

- **JWT_REFRESH_SECRET**: 
```bash
JWT_REFRESH_SECRET=eaa5191f2914e30b9387fd84e254e4ba6fc51b4654968a9b0803b456a54b8418
```

### Step 4: Insert Azure OpenAI Resource Details
Insert the API key from your Azure OpenAI Resource into the `.env` file and replace the resource name with yours:
```bash
# GPT Configuration
AZURE_OAI_API_KEY=YOUR AZURE OPENAI KEY
AZURE_OAI_RESOURCE=YOUR AZURE OPENAI RESOURCE NAME
```

If you want to use the LibreChat RAG-API (uploading and chatting with documants), you need to edit/add the following configuration in your `.env` file:
```bash
# Embeddings Configuration for RAG-API
EMBEDDINGS_PROVIDER=azure
EMBEDDINGS_MODEL=text-embedding-ada-002
# EMBEDDINGS_MODEL=text-embedding-3-small
RAG_AZURE_OPENAI_API_KEY=YOUR AZURE OPENAI KEY
RAG_AZURE_OPENAI_ENDPOINT=https://YOUR AZURE OPENAI RESOURCE NAME.openai.azure.com
RAG_AZURE_OPENAI_API_VERSION=2024-02-15-preview
```


### Step 5: Update Model Deployment Details
You may need to replace the model deployment details to fit your deployments in `librechat.yaml`:
```yaml
endpoints:
  azureOpenAI:
      titleModel: "gpt-4o-mini"
      titleConvo: true
      titleMethod: "completion"
      plugins: true
      assistans: false
      summarize: false
      groups:
        - group: "rg-germany-west-central"
          apiKey: "${AZURE_OAI_API_KEY}"
          instanceName: "${AZURE_OAI_RESOURCE}"
          version: "${AZURE_OAI_API_VERSION}"
          models:
            gpt-4o:
              deploymentName: "gpt-4o"
            gpt-4o-mini:
              deploymentName: "gpt-4o-mini"
```
</br>

### Step 6: Update Domain Information
If you are using a domain that is not `gpt.we-build-ai.de`, replace `gpt.we-build-ai.de` with your domain inside `.env`:
```.env
DOMAIN_CLIENT=https://gpt.we-build-ai.de
DOMAIN_SERVER=https://gpt.we-build-ai.de
```

---


## 4. Setting up SSL Encryption (HTTPS) and Connecting the Service to Your (Sub)domain

Before proceeding with certificate acquisition, ensure that your domain points to your cloud server’s IP address. This step is foundational and must precede SSL certificate setup due to the time DNS records may require to propagate globally.

### Steps to Point Your Domain:
1. Log in to your domain registrar’s control panel.
2. Navigate to DNS settings.
3. Create an A record pointing your domain to the IP address of your cloud server.
4. Wait for the DNS changes to propagate globally (you can check by pinging your domain: `ping your_domain.com`).


### Obtain an SSL/TLS Certificate
To secure your LibreChat application with HTTPS, you’ll need an SSL/TLS certificate. Let’s Encrypt offers free certificates.

#### Stop Container Instances

Before obtaining the SSL/TLS certificate, you need to stop the docker container instances running on your VM:

```bash
docker compose down
```

Check if there are no instances running any more:

```bash
docker ps
```

If there are still instances running, kill them:

```bash
docker stop <containerid>
```

#### Install Certbot:
```bash
sudo apt-get install certbot python3-certbot-nginx
```

#### Obtain the Certificate:
- Run the following command to obtain and install the certificate automatically for Nginx:
```bash
sudo certbot --nginx
```
- Follow the on-screen instructions. Certbot will ask for information and complete the validation process.
- Once successful, Certbot will store your certificate files.

### If You Are Using a Domain Other Than `gpt.we-build-ai.de`:
Replace `gpt.we-build-ai.de` with your domain inside `./client/nginx.conf` and `deploy-compose.yml`.
For the `./client/nginx.conf` file, follow the instructions given in the file itself comment/uncomment respective No-SSL and SSL sections. The domain needs to be replaced in two places here:

```bash
server_name gpt.we-build-ai.de;
server_name gpt.we-build-ai.de;
```

The domain needs to be replaced in three places in `deploy-compose.yml`:

```bash
- /etc/letsencrypt/live/gpt.we-build-ai.de/fullchain.pem:/etc/nginx/ssl/fullchain.pem:ro
- /etc/letsencrypt/live/gpt.we-build-ai.de/privkey.pem:/etc/nginx/ssl/privkey.pem:ro
- /etc/letsencrypt/live/gpt.we-build-ai.de/chain.pem:/etc/nginx/ssl/chain.pem:ro
```

### Post-Certificate Installation Steps
After obtaining and installing your SSL certificate with Certbot, you may encounter an issue where your domain displays the default Nginx welcome page instead of your intended application. This can occur if the Nginx default configuration overrides or conflicts with the configuration necessary to serve your Docker-based application. To resolve this, follow these steps:

#### Stop and Remove Default Nginx

```bash
sudo systemctl stop nginx
sudo apt-get remove nginx nginx-common
sudo apt-get purge nginx nginx-common
```

#### Kill Any Nginx Processes

```bash
ps aux | grep nginx
sudo pkill nginx
```

Ensure that Nginx has been completely removed by checking the configuration directory:

```bash
ls /etc/nginx
```

If the directory is empty or does not exist, Nginx has been successfully uninstalled.


---

## Setup EntraID Login
Follow the documentation in [LibreChat OAuth2-OIDC Azure Configuration](https://www.librechat.ai/docs/configuration/authentication/OAuth2-OIDC/azure).

At the end, you should have filled the following values in your `.env` file:
```.env
OPENID_CLIENT_ID=Your Application (client) ID
OPENID_CLIENT_SECRET=Your client secret
OPENID_ISSUER=https://login.microsoft.com/Your Directory (tenant ID)/v2.0/
OPENID_SESSION_SECRET=Any random string
```

## Setup Inbound Ports on the Virtual Machine
Add an inbound port rule for port 80 and 443 to your virtual machine.


### Finalize Build and Start LibreChat
Only if you are currently running any containers (`docker ps`), stop all running instances:
```bash
npm run stop:deployed
```

Build the instances that will be deployed:
```bash
npm run rebase:deployed
```

Start the application:
```bash
npm run start:deployed
```

</br>
Congratulations! Your app should now be running on your domain.

</br></br></br>
---

</br></br></br>
## Overview: Start, Stop, and Rebase the App
### Start the Docker Containers Powering LibreChat
```bash
npm run start:deployed
```

---

### Stop All Running Docker Containers
```bash
npm run stop:deployed
```

---

### If You Have Made Changes to `deploy-compose.yml`
Run this command (stop the app first, and start again afterwards):
```bash
npm run rebase:deployed
```


# Meine Schritte:

## gibt die öffentliche IP-Adresse der VM aus
az vm show --resource-group rg-librechat-intern --name vmlibrechatwbai -d --query publicIps -o tsv

## Berechtigungen des privaten Schlüssels korrigieren
chmod 600 ~/.ssh/vmlibrechatwbai_key.pem

## ssh verbindung zur vm herstellen
ssh -i ~/.ssh/vmlibrechatwbai_key.pem azureuser@<ip-adresse>

## update und install docker
sudo apt update
sudo apt install apt-transport-https ca-certificates curl software-properties-common gnupg lsb-release

## docker repository hinzufügen
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update

## docker installieren
sudo apt install docker-ce
sudo usermod -aG docker $USER

## reboot
sudo reboot

## docker-compose installieren
sudo curl -L https://github.com/docker/compose/releases/download/v2.26.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-composecd 

## git, nodejs und npm installieren
sudo apt install git nodejs npm

## clone the repository
git clone https://github.com/WEBUILDAI/LibreChat-wbai.git

## update the domain in the .env file
DOMAIN_CLIENT=https://librechat-wbai.germanywestcentral.cloudapp.azure.com
DOMAIN_SERVER=https://librechat-wbai.germanywestcentral.cloudapp.azure.com

## In azure portal in der puplic adresse die domain anlegen und die ip adresse zuweisen

# In Azure innerhalb der Network Security Group die Regel für den eingehenden Datenverkehr für die Ports 80 und 443 freigeben (inbound ports)

AllowAnyCustom3080Inbound 443: Allow all https
(AllowAnyHTTPInbound 80: Allow all http) TODO: wahrscheinlich nicht nötig weil wird auf https umgeleitet

# Install Certbot:
sudo apt-get install certbot python3-certbot-nginx

# Obtain the Certificate:
Run the following command to obtain and install the certificate automatically for Nginx:
sudo certbot --nginx
Follow the on-screen instructions. Certbot will ask for information and complete the validation process.
Once successful, Certbot will store your certificate files.
- hier ist wichtig, dass die domain ohne http oder https angegeben wird sowie ohne backslash am ende "librechat-wbai.germanywestcentral.cloudapp.azure.com"
- ebenfalls ist es nötig bei ängeren domains innerhalb der nginx.conf im http block die bulk size anzupassen 
```bash
http {
    server_names_hash_bucket_size 128;

    # evtl. vorhandene weitere Direktiven
    ...
}
```

# in nginx.conf den servername angeben (in der SSL section)
```bash
server_name librechat-wbai.germanywestcentral.cloudapp.azure.com;
```

## in deploy_compose.yml die certifikate mounten

  client:
    image: nginx:1.27.0-alpine
    container_name: LibreChat-NGINX
    ports:
      - 80:80
      - 443:443
    depends_on:
      - api
    restart: always
    volumes:
      - ./client/nginx.conf:/etc/nginx/conf.d/default.conf
      - /etc/letsencrypt/live/librechat-wbai.germanywestcentral.cloudapp.azure.com/fullchain.pem:/etc/nginx/ssl/fullchain.pem:ro
      - /etc/letsencrypt/live/librechat-wbai.germanywestcentral.cloudapp.azure.com/privkey.pem:/etc/nginx/ssl/privkey.pem:ro
      - /etc/letsencrypt/live/librechat-wbai.germanywestcentral.cloudapp.azure.com/chain.pem:/etc/nginx/ssl/chain.pem:ro

## in client/nginx.conf
- Non-SSL section auskommentieren
- SSL section einkommentieren
- zwei ssl certificate ersetzen (ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key;) durch ssl_certificate /etc/nginx/ssl/fullchain.pem; ssl_certificate_key /etc/nginx/ssl/privkey.pem;
- (Wichtig, da sonst nginx container failed beim starten und alle certificate nicht gesetzt werden können) ssl_dhparam /etc/nginx/ssl/dhparam; auskommentiert! (TODO:sollte gemountet werden)


## OPENID (anleitung auf Librechat docs ist gut, aber folgendes ist zu beachten): 
- keine gruppen angeben
- .env anpassungen: 
ALLOW_EMAIL_LOGIN=false (vorher true)
ALLOW_REGISTRATION=false (vorher true)
ALLOW_SOCIAL_LOGIN=true (vorher false)
ALLOW_SOCIAL_REGISTRATION=false
ALLOW_PASSWORD_RESET=false
# ALLOW_ACCOUNT_DELETION=true # note: enabled by default if omitted/commented out
ALLOW_UNVERIFIED_EMAIL_LOGIN=false (vorher true)

zudem: 
- librechat.yml: 
  - registraction -> socialLogins: ['openid'] (github etc. entfernen)
## TODO:
- wie kann ssl_dhparam /etc/nginx/ssl/dhparam; gemountet werden? Wo bekommt man dieses certificate?
- Setup für login über EntraID
- muss die inbound nsg für AllowAnyHTTPInbound (80: Allow all http) überhaupt verwendet werden?
- RAG API muss noch eingerichtet werden
- certbot lkäuft nicht mehr, da nginx komplett entfernt und gestoppt wurde -> herausfinden, wie man das korrekt aufsetzt!

# angezeigte modelle: 
- .env: 
  - ENDPOINTS=azureOpenAI (ansonsten werden auch grok etc. angezeigt)
- librechat.yml: 
  nur noch azureOPenAI als custom endpoint angeben